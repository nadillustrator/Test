{"__id":"332bfec0-96e3-4433-9bb9-935894a6563c","namespace":"records_management_.business_trips","code":"_create","__name":"Форма создания","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":9,"hidden":false,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"cb61a90c-2c0d-4e34-afcd-1ed672fe3dd6","descriptor":"item-form-complex-popup","descriptorVersion":2,"values":{"formGroup":{"path":["item"]}},"content":{"[content]":[{"id":"c18e9118-cda2-49f4-ae50-5414c9b970b2","descriptor":"modal-body","values":{"shadow":true},"content":{"":[{"id":"10f2b1d8-32a8-42e4-a8f6-b6ef45bba058","descriptor":"dynamic-form-row","values":{"required":true,"hideEmpty":false,"__readOnly":null,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","our_company"]},"tooltip":null}},{"id":"aa5e2492-6615-457f-98d5-a9319ef79ce5","descriptor":"dynamic-form-row","values":{"required":false,"hideEmpty":false,"__readOnly":true,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","emloyee"]},"tooltip":null}},{"id":"d4a07090-b5ae-444a-a648-f11ebb2628a1","descriptor":"dynamic-form-row","values":{"__readOnly":null,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","chief"]},"tooltip":null,"required":false,"hideEmpty":false}},{"id":"d651482f-b793-43df-b79a-de7115ac7810","descriptor":"dynamic-form-row","values":{"hideEmpty":false,"__readOnly":null,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","city"]},"tooltip":null,"required":true}},{"id":"695b6c70-e4cc-40fe-8c8d-dc46658e2117","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","client_or_partner"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":null}},{"id":"0341ab30-6957-4ca6-a2c3-51339627a4d8","descriptor":"dynamic-form-row","values":{"hideEmpty":false,"__readOnly":null,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","trip_reason"]},"tooltip":null,"required":true}},{"id":"920ae3df-8a5a-45cd-9682-ca318a12962f","descriptor":"row","values":{"__renderContentAsync":false},"content":{"":[{"id":"2471a437-e614-4fda-96d0-969e4674f767","descriptor":"column","content":{"":[{"id":"4b2e1930-3f15-4d73-a035-026ebcc52fd7","descriptor":"dynamic-form-row","values":{"tooltip":null,"required":true,"hideEmpty":false,"__readOnly":null,"bindingMode":false,"onChangeValue":{"kind":"Function","name":"onDateChange","type":"client"},"showDisplayName":true,"control":{"path":["item","start_date"]}}}]}},{"id":"dfc927fa-afb6-4aea-9da8-0f484f14ca82","descriptor":"column","content":{"":[{"id":"a5140418-2b83-4e05-aaa9-b345a338b1b8","descriptor":"dynamic-form-row","values":{"onChangeValue":{"kind":"Function","name":"onDateChange","type":"client"},"showDisplayName":true,"control":{"path":["item","end_date"]},"tooltip":null,"required":true,"hideEmpty":false,"__readOnly":null,"bindingMode":false}}]}}]}},{"id":"80c1f265-5290-485c-8f95-69fe81b97c48","descriptor":"dynamic-form-row","values":{"__readOnly":true,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","info"]},"tooltip":null,"__styles":"color:red","required":false,"hideEmpty":true}},{"id":"bd46eddc-453d-41d2-b6ba-842621259ac8","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","duration"]},"tooltip":null,"required":false,"hideEmpty":true,"__readOnly":null}},{"id":"2d62fbb9-f512-495f-974f-666a8b420209","descriptor":"dynamic-form-row","values":{"control":{"path":["item","sum_daily_allowance"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":true,"bindingMode":false,"showDisplayName":true}},{"id":"efc76494-54c9-4dd5-bc7c-c1b6179cb71d","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","need_tickets"]},"tooltip":null,"required":true,"hideEmpty":false,"__readOnly":null}},{"id":"6c04e2a6-0ea6-43f8-b5a7-967ac8e8ad0b","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","passport"]},"tooltip":null,"required":{"path":["item","need_tickets"]},"hideEmpty":false,"__readOnly":null}},{"id":"0cff1146-b817-48a1-9fff-411efd25f77f","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","ticketsComment"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":null}}]}}],"[sidebar]":[{"id":"662f08da-59da-4112-9ae1-763785ab8bf2","descriptor":"sidebar-widget","content":{"":[{"id":"1556d7a7-eaa5-41a2-b262-82ec3b86e64d","descriptor":"user-guide"}]}}],"[headerControls]":[],"[headerCustomization]":[],"[footer]":[{"id":"dd9c099c-c683-4330-8287-8ea78f9c4e9f","descriptor":"zone-content","values":{"zoneCode":"[footer]"}}]}},"fieldVisibilityConditions":{},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\nasync function onDateChange(): Promise\u003cvoid\u003e {\n    Context.data.info =\"\";\n    Context.data.duration = undefined;\n    Context.data.sum_daily_allowance = undefined;\n    if (Context.data.start_date \u0026\u0026 Context.data.end_date){\n        if (Context.data.end_date.after(Context.data.start_date) || Context.data.end_date.equal(Context.data.start_date)){\n           //приводим даты к типу TDatetime\n            const start = Context.data.start_date.asDatetime(new TTime(0,0,0,0));\n            const end = Context.data.end_date.asDatetime(new TTime(23,59,0,0));\n            //расчет продолжительности командировки в днях\n            Context.data.duration = Math.floor(end.sub(start).hours/24)+1;\n            //расчет суммы суточных исходя из стандартного значения 700 руб/сутки\n            Context.data.sum_daily_allowance = new Money(700, 'RUB').multiply(Context.data.duration);\n            Context.data.info =\"\";\n            } \n            else {\n            Context.data.info = \"Дата начала поездки не должна быть больше даты окончания!\"\n            Context.data.duration = undefined;\n            Context.data.sum_daily_allowance = undefined;\n        }\n    } \n}\nasync function onInit() {\n    Context.data.emloyee = await System.users.getCurrentUser();\n    if(Context.data.emloyee){\n        const chiefs = await Context.data.emloyee.getChiefs();\n        if (chiefs){\n            Context.data.chief = chiefs[0];\n        }\n    }\n}\n","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{},"dataFieldCode":"item"},"dataNamespace":"records_management_","dataCode":"business_trips","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server) {\n        async function onDateChange() {\n            Context.data.info = \"\";\n            Context.data.duration = undefined;\n            Context.data.sum_daily_allowance = undefined;\n            if (Context.data.start_date \u0026\u0026 Context.data.end_date) {\n                if (Context.data.end_date.after(Context.data.start_date) || Context.data.end_date.equal(Context.data.start_date)) {\n                    const start = Context.data.start_date.asDatetime(new TTime(0, 0, 0, 0));\n                    const end = Context.data.end_date.asDatetime(new TTime(23, 59, 0, 0));\n                    Context.data.duration = Math.floor(end.sub(start).hours / 24) + 1;\n                    Context.data.sum_daily_allowance = new Money(700, 'RUB').multiply(Context.data.duration);\n                    Context.data.info = \"\";\n                }\n                else {\n                    Context.data.info = \"Дата начала поездки не должна быть больше даты окончания!\";\n                    Context.data.duration = undefined;\n                    Context.data.sum_daily_allowance = undefined;\n                }\n            }\n        }\n        async function onInit() {\n            Context.data.emloyee = await System.users.getCurrentUser();\n            if (Context.data.emloyee) {\n                const chiefs = await Context.data.emloyee.getChiefs();\n                if (chiefs) {\n                    Context.data.chief = chiefs[0];\n                }\n            }\n        }\n        return {\n            onDateChange,\n            onInit\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onDateChange","parameters":[],"type":"[object Object]"},{"name":"onInit","parameters":[],"type":""}]},"__createdAt":"2022-09-13T10:36:51.072268398Z","__createdBy":"6f0a6450-48ab-4e40-98c2-97154e119f5e","__updatedAt":"2022-09-14T11:23:21.278034106Z","__updatedBy":"d4814328-6c2d-4312-91b9-ec5b5a3d9a6a","__deletedAt":null}
